name: Maintenance Automatique - La Roulotte Solidaire

on:
  schedule:
    - cron: "0 2 * * *"   # Tous les jours √† 02h00
  workflow_dispatch:       # Permet de lancer manuellement

jobs:
  maintenance:
    name: Maintenance du d√©p√¥t
    runs-on: ubuntu-latest

    steps:
      - name: R√©cup√©ration du d√©p√¥t
        uses: actions/checkout@v3

      ############################################################
      # 1. SUPPRESSION DES M√âTADONN√âES EXIF (PROTECTION DIGNIT√â)
      ############################################################
      - name: Nettoyage EXIF des images
        run: |
          echo "üßπ Suppression des m√©tadonn√©es EXIF..."
          sudo apt-get update
          sudo apt-get install -y exiftool
          for f in $(find photos -type f \( -iname "*.jpg" -o -iname "*.jpeg" -o -iname "*.png" \)); do
            exiftool -overwrite_original -all= "$f"
            echo "EXIF nettoy√© : $f"
          done

      ############################################################
      # 2. COMPRESSION AUTOMATIQUE DES IMAGES
      ############################################################
      - name: Compression des images
        run: |
          echo "üì¶ Compression des images..."
          sudo apt-get install -y imagemagick
          for f in $(find photos -type f \( -iname "*.jpg" -o -iname "*.jpeg" \)); do
            mogrify -strip -resize 1920x1920\> -quality 85 "$f"
            echo "Compress√© : $f"
          done

      ############################################################
      # 3. V√âRIFICATION DES FICHIERS ORPHELINS
      ############################################################
      - name: V√©rification des fichiers sans DESCRIPTION.md
        run: |
          echo "üßæ V√©rification des descriptions..."
          erreurs=0
          for d in $(find photos videos -type d); do
            if ls "$d"/*.{jpg,jpeg,png,mp4} >/dev/null 2>&1; then
              if [ ! -f "$d/DESCRIPTION.md" ]; then
                echo "‚ùå Pas de DESCRIPTION.md dans : $d"
                erreurs=1
              fi
            fi
          done
          if [ $erreurs -eq 1 ]; then exit 1; fi
          echo "‚úîÔ∏è Toutes les descriptions sont pr√©sentes"

      ############################################################
      # 4. V√âRIFICATION DES EXTENSIONS DANGEREUSES
      ############################################################
      - name: V√©rification des extensions interdites
        run: |
